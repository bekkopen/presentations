<!doctype html>
<html lang="no">

	<head>
		<meta charset="utf-8">

		<title>Ytelse og stabilitet 101</title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="../assets/revealjs/css/reveal.min.css">
		<link rel="stylesheet" href="../assets/revealjs/css/theme/default.css" id="theme">
		<link rel="stylesheet" href="../assets/revealjs/css/zenburn.css" id="theme">
		<style type="text/css">
			ul.checkmark li:before{
    			content:"\2713\0020";
			}
			ul.checkmark li{
				list-style-type:none;
			}
			column{
				float: left;
				text-align: left;
				width: 50%;
			}
			emphasize{
				color: #ff6600;
			}
		</style>
	</head>

	<body>
	<div class="reveal">
		<div class="slides">

				<section>
					<h2>Ytelse og stabilitet 101</h2>
                    <h4>Javazone, 11. september 2013</h4>
				</section>

				<section>
					<div style="float:left;width:50%;text-align:left">
						<h3>Stefan Magnus Landrø</h3>
						<ul class="checkmark">
							<li>10++ år med progging</li>
							<li>Faggruppeleder Cloud og Big data i BEKK</li>
						</ul>
					</div>
					<div style="float:left;width:50%">
						<img src="assets/stefan.jpeg" align="right">
					</div>
				</section>

                <section data-background="assets/queue.jpg">
                </section>

                <!-- Agenda -->
				<section>
					<h2>Agenda</h2>
					<ul>
						<li class="fragment">Ressursmangel</li>
                        <li class="fragment">Monitorering av JVM med JVisual VM (demo)</li>
                        <li class="fragment">Ytelsestesting med Gatling (demo)</li>
                        <li class="fragment">Analyse av Thread dumps (demo)</li>
						<li class="fragment">Analyse av Heap dumps (demo)</li>
						<li class="fragment">Erfaringer fra krigen (demo)</li>
						<li class="fragment">Oppsummering</li>
					</ul>
				</section>

                <!-- Ressursmangel -->
                <section>

                    <section>
                        <h2>Ressursmangel</h2>
                    </section>

                    <section data-background="assets/queue.jpg">
                    </section>

                    <section>

                        <ul>
                            <li class="fragment">CPU (super computing)</li>
                            <li class="fragment">RAM (out of memory exception)</li>
                            <li class="fragment">Ressurser som ikke er thread safe
                                <ul>
                                    <li class="fragment">Database connection</li>
                                    <li class="fragment">HTTP connection (endres i SPDY!)</li>
                                    <li class="fragment">XML Marhaller (object <-> XML)</li>
                                    <li class="fragment">...</li>
                                </ul>
                            </li>
                            <li class="fragment">Threads (thread starvation)</li>
                            <li class="fragment">Etc etc ...</li>
                        </ul>
                    </section>

                    <section data-background="assets/queue.jpg">
                    </section>

                    <section>
                        <h2>Noen ganger kan man betale seg ut av ressursmangel!</h2>
                    </section>
                    <section>
                        <h2>Noen ganger kan man kode seg ut av ressursmangel!</h2>
                    </section>
                    <section>
                        <h2>Noen ganger kan man <strong style="color: red;">enkelt</strong> kode seg ut av ressursmangel!</h2>
                    </section>

                </section>

                <!-- Monitorering med JVisual VM -->
                <section>

                    <section>
                        <h2>Monitorering</h2>
                    </section>

                    <section data-background="assets/jvisualvm.png">
                    </section>

                    <section>
                        <h2>JVM monitoreres over JMX</h2>
                        <ul>
                            <li class="fragment">Java VisualVM</li>
                            <li class="fragment">JConsole</li>
                            <li class="fragment">...</li>
                        </ul>
                    </section>

                    <section>
                        <ul>
                            <li class="fragment">CPU</li>
                            <li class="fragment">Heap Memory</li>
                            <li class="fragment">Heap Memory dump</li>
                            <li class="fragment">Threads</li>
                            <li class="fragment">Thread dump</li>
                            <li class="fragment">...</li>
                        </ul>
                    </section>

                    <section>
                        <h2>DEMO</h2>
                    </section>

                </section>

                <!-- Gatling -->
                <section>

                    <section>
                        <h2>Ytelsestesting med Gatling</h2>
                    </section>

                    <section>
                        <img src="assets/gatling-logo.png" style="margin:0; border: 0; background: none">
                        <br>
                        <a href="http://gatling-tool.org/">http://gatling-tool.org/</a>
                    </section>

                    <section>
                        <ul>
                            <li>Ytelsestestverktøy</li>
                            <li>Open source (Apache 2)</li>
                            <li>Scala DSL</li>
                            <li>Actors (Akka)</li>
                            <li>Asynkron HTTP klient (Netty)</li>
                        </ul>
                    </section>

                    <section>
                        <ul>
                            <li>Opprett prosjekt med maven archetype</li>
                            <li>Skriv tester i IDE (IntelliJ)</li>
                            <li>Kjør test i IDE eller maven</li>
                            <li>Kjør tester (kontinuerlig) på Jenkins</li>
                        </ul>
                    </section>

                    <section>
                        <h2>DEMO</h2>
                    </section>


                </section>

                <!-- Thread dumps -->
                <section>

                    <section>
                        <h2>Analyse av thread dumps</h2>
                    </section>

                    <section data-background="assets/thread-dump.png">
                    </section>

                    <section>

                        <h3>Enum Thread.State</h3>

                        <ul>
                            <li>NEW - not yet started</li>
                            <li>RUNNABLE - executing in the JVM</li>
                            <li>BLOCKED - blocked waiting for a monitor lock</li>
                            <li>WAITING - waiting indefinitely for another thread to perform a particular action</li>
                            <li>TIMED_WAITING- waiting for another thread to perform an action for up to a specified waiting time</li>
                            <li>TERMINATED - exited</li>
                         </ul>

                    </section>

                    <section>
                            <h2 class="fragment">BLOCKED</h2>
                            <h2 class="fragment">WAITING</h2>
                            <h2 class="fragment">TIMED_WAITING</h2>
                            <h2 class="fragment" style="color: red;">Bad news?</h2>
                    </section>

                    <section data-background="assets/queue.jpg">
                    </section>

                    <section>
                        <code>
                            kill -QUIT &lt;PID&gt;
                        </code>
                    </section>

                    <section>
                        <h2>DEMO</h2>
                    </section>

                </section>

                <!-- Heap dumps -->
                <section>

                    <section>
                         <h2>Heap dumps</h2>
                    </section>

                    <section>
                         <h2>En heap dump er en snapshot av minnet til en java process</h2>
                    </section>

                    <section>
                        <code>
                            -XX:+HeapDumpOnOutOfMemoryError
                        </code>
                    </section>

                    <section>
                        <code>
                           jmap -dump:format=b,file=&lt;filename&gt; &lt;pid&gt;
                        </code>
                    </section>

                    <section>
                        <h2>DEMO</h2>
                    </section>

                </section>

                <!-- Krigserfaring -->
                <section>

                        <section>
                            <h2>Krigserfaring</h2>
                        </section>

                       <section>
                           <h3>Eksempel:</h3>
                           <ul>
                               <li>Heap dump Apache CXF Client</li>
                               <li class="fragment">WS-Adressing og MTOM</li>
                               <li class="fragment">PDF payload</li>
                           </ul>
                       </section>

                        <section>
                            <h3>Eksempel:</h3>
                            <ul>
                                <li>Thread dump JBoss PDP (XACML)</li>
                                <li class="fragment">Sikkerhetsrammeverk</li>
                                <li class="fragment">Sjekker tilgangsrettigheter mot eksterne kilder</li>
                            </ul>
                        </section>

                        <section>
                            <pre>
                                <code>
Name: http-/0.0.0.0:8443-295
State: WAITING on java.util.concurrent.locks.ReentrantLock$NonfairSync@27c85959 owned by: http-/0.0.0.0:8443-266 Total blocked: 29  Total waited: 48

Stack trace:
sun.misc.Unsafe.park(Native Method)
java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)
java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)
java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)
java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:214)
java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)
org.jboss.security.xacml.core.JBossPDP.evaluate(JBossPDP.java:291)
no.nav.modig.security.tilgangskontroll.policy.pdp.picketlink.PicketLinkDecisionPoint.evaluate(PicketLinkDecisionPoint.java:49)
no.nav.modig.security.tilgangskontroll.policy.pep.PEPImpl.evaluate(PEPImpl.java:31)
no.nav.modig.security.tilgangskontroll.policy.pep.PEPImpl.hasAccess(PEPImpl.java:43)
no.nav.modig.security.tilgangskontroll.policy.pep.PEPImpl.assertAccess(PEPImpl.java:36)
                                </code>
                            </pre>

                        </section>

                        <section>
                            <pre><code class="java">
Stuff stuff = null;
lock.lock();  // linje 291

try {

  stuff = getStuffFromCache();

  if (stuff = null) {
      stuff = expensiveOperation();
  }

finally {
  lock.unlock();
}
                            </code></pre>

                        </section>

                </section>


                <!-- Oppsummering -->
                <section>

                    <section>
                        <h2>Oppsummering</h2>
                    </section>

                    <section data-background="assets/queue.jpg">
                    </section>

                </section>


        </div>
    </div>

	<script src="../assets/revealjs/lib/js/head.min.js"></script>
	<script src="../assets/revealjs/js/reveal.min.js"></script>

	<script>

			Reveal.initialize({
				transition: 'linear',
				history: true,
				dependencies: [
					{ src: '../assets/revealjs/lib/classList.js', condition: function() { return !document.body.classList; } },	
					{ src: '../assets/revealjs/lib/js/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },					
					{ src: '../assets/revealjs/lib/js/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>
	</body>
</html>
